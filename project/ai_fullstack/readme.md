# AI 全栈项目

## 技能点
### react 开发全家桶
- react + typescript(JS超级)
- react-router-dom(前端路由)
- zustand (中央状态管理)
- axios (http请求库) 

### 后端
- node + ts 
- nestjs 企业级别后端开发框架 
- psql 数据库
- redis 缓存数据库
### AI 
- langchain 
- coze/n8n 
- llm 
- trae/cursor 
## 项目安排
- frontend
- backend
- ai_server
- admin 后台管理系统

## git 操作 
- 全新的实战项目 
  git init 
- 提交的时机
  每次完成一个相对独立的模块后，提交一下
  提交信息要准确完整

## react 全家桶
### react-router-dom 
- 前端路由 
早期前端没有路由，路由由后端，前端是切图崽
前后端分离， 前端有独立的（html5）路由，实现页面切换。
- 两种形式
  - HashRouter  #/ 丑一点 很温柔 兼容性很好 瞄点  
  - BrowserRouter / 和后端路由一样，需要使用到html5 history API 
  兼容不好，ie11 之前不兼容， 现在的浏览器几乎都支持 
- as Router 可读性 
- 性能， 快 页面组件的懒加载
  /   Home  延迟一下About  阻止加载
  /About About 

### 路由有多少种？
- 普通路由 
- 动态路由 /product/:id
- 通配路由 * 
- 嵌套路由 Outlet 
  <Outlet> 是 React Router DOM 中的组件，用于在父路由元素中渲染其子路由匹配到的内容。
- 鉴权路由（路由守卫） ProtectRoute
- redirect 重定向路由 Navigate
### 路由生成访问历史
  history 栈 先进后出
  replace redirect 跳转，会替换当前的历史记录
### 单页应用
- 传统的开发是多页的，基于http 请求，每次url 发生改变后，去服务器重新请求整个页面。
  体验不好，页面会白一下
- 单页应用 react-router-dom html5 history 
  前端路由
  路由改变后
  前端会收到一个事件， 讲匹配的新路由显示在页面上

## typescript 
JavaScript 超级 ， 强类型静态语言
- 安装 ts 
  npm install -g typescript
- ts 的优点
  - 静态类型
  - 边写边检查bug 
  - 编译时检查类型错误
  - 代码建议、文档查看都非常方便
  - 没有使用变量等垃圾代码提示未使用（console.log（））
    重构、修改别人的代码
    干净的代码
### typescript 实战 todos 
### zustand 状态管理
如果说国家需要有中央银行，那么前端项目就需要中央状态管理系统。zustand \redux 
- 组件 = UI+State
- store 将状态存到store仓库中管理
  全局共享
- 基于hooks思想实现的

## 数据库设计 
- 关系型数据库 mysql\postgresql
是一种以二维表格（行/列）组织存储数据，通过主键（Primary key）
外键简历表格间逻辑关联，遵循ACID 事务特性保证数据一致性和可靠性的数据库。
表Table users 类
row 实例 
column 属性
### 主键 
- 词典
  索引目录
- 唯一的 ， 自增的 
- 高效 利用索引
### 唯一索引 uniq  约束
  - username   唯一性， 正确性
### 外键 约束 foreign key
  - posts 文章id,  userId 
  - id  引用 users 表的主键
  posts.userId == user.id 关联
### 普通外键 key 
  - 不能乱建
  - 查询的频繁度

### 文章系统
- 文章表 posts 
- 用户表 users
- 评论表 comments
- 点赞表 likes 
- 标签表 tags 
- 收藏表 favorites

### 连接
- 左连接 left join 
  左表所有数据都显示，右表匹配的显示，不匹配的null
- 右连接 right join 
  右表所有数据都显示，左表匹配的显示，不匹配的null
- 内连接 inner join 
  只显示左右表匹配的数据

### ACID
- 事务 transaction 
数据库操作的最小单位，
A Atomicity 原子性
要么都成功， 要么全部失败回滚。
转账 扣A的100元，和增加B的100元。 转账事务
- A 成功  type out 减少总金额 先 成功。回滚失败
- B 成功 type in 增加总金额 后 失败， 回滚A的操作

C Consistency 一致性 
数据库从一个一致状态转换到另一个一致状态，
转账事务中，A和B的总金额保持不变。

Isolation 隔离性 
并发执行的事务 相互独立， 互不干扰。 
两笔转账， A转B 100元， C 转B 200 元

D Durability 持久性
事务一旦提交， 对数据库的改变是永久的， 不会因为系统故障而丢失。

### psql
#### 基本操作
- \list 列出所有数据库
- 创建数据库
CREATE DATABASE xuebi WITH OWNER=postgres ENCODING='UTF-8';
- 进入数据库
\c xuebi
### prompt 建表

```
你是一位psql高级工程师，需要设计一个users表,
包含id, name, password三个字段。id 自增，主键，name 不能重复，
请给出建表sql

CREATE TABLE users (
    -- 使用 BIGINT 避免未来数据量过大导致 ID 溢出，IDENTITY 是 SQL 标准自增方式
    -- INT（上限21亿) BIGINT（8字节）
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    
    -- UNIQUE 约束会自动创建索引，NOT NULL 保证数据完整性
    name VARCHAR(255) NOT NULL UNIQUE,
    
    -- 密码字段，通常长度设为 255 以适配各种哈希加密算法（如 bcrypt）
    password VARCHAR(255) NOT NULL,
    
    -- 高级工程师通常会增加这两个审计字段
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP
);
```

### seeds 初始化数据
```
  INSERT INTO "users" ("id", "name", "password") VALUES
  ('1', '王皓', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('2', '小雪', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('3', '李白', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('4', '杜甫', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('5', '白居易', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq'),
  ('6', '张三', '$2b$10$CsO/ykedPpuxqUETBZTYm.F2U4TXDdo01rLmoRPwjKBv3pIL5pnWq');
```

 你是一位psql 高级工程师， 需要建一个posts 表， 包含id, title, content,userId 三个字段。id 自增， 主键， title 不为空，不超过255个字符， content  长文本，  usersId 是bigint 类型，是 users 表的外键，请给出建表sql

 CREATE TABLE posts (
     id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    content TEXT,
    "userId" BigInt NOT NULL,
     -- 高级工程师通常会增加这两个审计字段
    created_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMPTZ DEFAULT CURRENT_TIMESTAMP,

    CONSTRAINT fk_posts_user FOREIGN KEY ("userId") REFERENCES users(id) ON DELETE CASCADE
);

## nestjs
### express 及简框架
nestjs 企业级开发，基于typescript ,采用模块化架构和依赖注入，
旨在构建高效、可扩展切易于维护的企业级后端应用

- npm i -g @nestjs/cli
- 新建项目 nest new nest-test-demo

### nestjs 理解
- 工厂模式 
- main.ts 入口文件
- Module 
  app.module.ts

### http 请求动作 
语义化  restful 一切皆资源  
Method + url 定义方式 
- GET/POST 
- PUT 上传（更新）头像
- PATCH 局部更新 nickname password。。。
- DELETE 删除用户

## notes AI 全栈项目 
- 登录功能 
- 文章系统 
- AIGC 功能
- nestjs 后端 
### shadcn 
- 页面由组件构成，选用第三方组件库
- 严格按需加载
- 组件下载到本地，可以随意的修改。
- 基于tailwindcss 
- 配置alias 设置路径别名，更短，好用
### vite 的配置
- vite.config.ts 配置对象 
- plugins 插件
  react | vue
  tailwindcss
- resolve 
  alias 路径别名
  @ -> __dirname/src 
  npm i -D @types/node node 来到ts 开发的时候 
  单独安装了node 的类型申明文件
- ts 配置文件
  根目录下的 tsconfig.app.json
  compilerOptions 目录输出建议
  baseUrl
  path

- npx shadcn@latest init
npx 是 Node.js 自带的工具，用于临时安装并**执行** npm 包中的命令，无需全局或本地预先安装。
不用预先安装 ， 试用，测试那边， 用完会删除 
- shadcn 提供命令行
  - button
  npx shadcn@latest add button

### 路由
- 路由懒加载（性能优化的关键）
- suspense + lazy 实现路由懒加载
- 自定义loading 组件

### keepalive
### 登录store的持久化

### BackToTop组件
- 通用组件
- 自有状态isVisible 
- onScroll 判断一个阀值
- scroll事件频繁触发，性能优化
  节流 utils 目录下 工具函数 
- 组件卸载时 移除事件监听，防止内存泄漏。

### 幻灯片组件 slides 
- shadcn 提供了 Carousel、CarouselContent、CarouselItem、
  一组组件，层次结构
- 自动播放的功能作为插件引入， shadcn 简单性能好，定制性更好
  useRef  持久化可变的对象
  plugins=[]
- api 向外暴露Carsoul 的各种功能
  selectedIndex 私有状态
  api onSelect 方法 改变之
- 指示点
  循环输出
  动态类名
- css 
  - transition-all 
  - gradient  线性渐变， 取代图片（渐变色）做背景
  性能优化 图片做背景 http下载的开销，减少http并发数

### store 
- user 全局共享 
- 每个页面级别组件都有自己独立的store 
  组件 UI 和 数据分离 

### Post List 
- 数据怎么提供呢？
  - 真实数据 在后端
  - axios 请求 后端api 
  - 前端要等待后端接口吗？不能等，前后端分离的基础上，
  前端可以自行解决数据需求？ mock 一下 伪造请求
  api接口文档 
  GET /api/posts?page=1&limit=10 返回内容 
  {
    status: 200,
    list: Post[]
  }
  只要切换后端真正的地址，无缝对接

### mockjs 
- 前端接口伪造，开发时候用，上线前切换成后端接口，
  vite 启动 mock 
- 前后端确立接口开发文档
### posts mock
- 阅读接口文档
- mockjs 语法
  mockPath posts.js
  export default {
    {
      url:,
      method:,
      response:(req, res) => {}
    }
  }
  - mockjs 随机功能  @ 
  - 分页机制
    - page, limit parseInt 
    - start, end, total, totalPage
    - slice 
    - pagination 

## JWT登录 
- http 无状态的
Cookie Authorization token 身份令牌
-  颁发令牌 token 
- jwt 
  pnpm i json(用户身份对象)web(形式)token(令牌)
  用户名+密码 {id:1, name:'admin'} json  加密成一个token 
  请求时，再传过来 服务器端 decode 得到用户对象， 
  - sign方法 服务器 用户对象， secret, 过期时间 给前端颁发token
  - decode方法，解析请求头 authorization  服务器拿到用户对象 

## api 后端接口项目
- nest new posts 
  高度模块化、依赖注入特性的企业级开发框架
- 数据库 
### prisma ORM 
将数据库映射成对象
Table -> 类
row  -> 实例
props -> props 
psql/mysql sql 太专业了，prisma 翻译官 
后端 -》              prisma ->     sql 
User(service class)   ===          User(table)
create               ===        Insert 
findMany             ===             Select
### ORM ObjectRelationMapping 对象关系映射
### Prisma 的初始化流程
- 建数据库
- prisma 命令行 + @prisma/client(ORM)
- npx prisma init   
### schema 文件 
数据库是最重要的 ，schema 就是数据库设计稿， 设计文件保留下来
用model模型类的概念 描述数据表 
@id   primary key 
@default(@increment())
@db.Varchar(255)
@unique  
### migrate 数据表的迁移
- 方便
- 留下日志
### seeds 
### DTO Data Transfer Object 
丛前端-》后端-》控制器-》service  transfer 过程
- dot/post-query.dto.ts
- dot/post-new.dto.ts
- class-validator 验证器 
  将参数的校验 流程化， 规范化
- 全局配置一下
### @prisma/client
- 怎么给service提供 client 代替db 